{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Clone - Sign Up</title>
    <link rel="icon" type="image/x-icon" href="{% static 'marshmello_favicon.png' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <style>
        :root {
            --spotify-green: #1DB954;
            --spotify-black: #191414;
            --spotify-white: #FFFFFF;
        }

        body {
    min-height: 100vh;
    margin: 0;
    background: linear-gradient(135deg, #191414 0%, #232526 50%, #1DB954 100%);
    font-family: 'Circular Spotify Tx T Book', 'Segoe UI', Arial, sans-serif;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
}
.signup-container {
    background: #000;
    border-radius: 10px;
    box-shadow: 0 4px 32px rgba(0,0,0,0.4);
    padding: 2.5rem 2rem 2rem 2rem;
    max-width: 430px;
    width: 100%;
    margin: 2rem 1rem;
    display: flex;
    flex-direction: column;
    align-items: center;
}


        .logo {
            text-align: center;
            margin-bottom: 2rem;
        }

        .logo i {
            font-size: 2.5rem;
            color: var(--spotify-green);
        }

        .signup-title {
            text-align: center;
            margin-bottom: 2rem;
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--spotify-white);
        }

        .form-group {
            width: 100%;
            margin-bottom: 1.2rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.4rem;
            color: #b3b3b3;
            font-weight: 500;
        }

        .input-group {
            position: relative;
            width: 100%;
        }

        .input-group i.fa {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: #b3b3b3;
            font-size: 1rem;
        }

        .form-control, .form-select {
            width: 100%;
            padding: 0.75rem 0.75rem 0.75rem 2.5rem;
            border-radius: 4px;
            border: 1px solid #535353;
            background: #121212;
            color: var(--spotify-white);
            font-size: 1rem;
            transition: border-color 0.2s;
            outline: none;
            appearance: none;
        }

        .form-select {
            padding-left: 2.5rem;
            cursor: pointer;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--spotify-green);
            background: #121212;
            color: var(--spotify-white);
        }

        .form-control.is-invalid, .form-select.is-invalid {
            border-color: #eb5757;
        }

        .toggle-password {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #b3b3b3;
            font-size: 1rem;
            z-index: 2;
        }

        .error-message {
            color: #eb5757;
            font-size: 0.93rem;
            margin-top: 0.3rem;
            margin-bottom: -0.6rem;
            display: none;
            min-height: 1.1em;
        }

        .row-flex {
            display: flex;
            gap: 1rem;
        }
        .row-flex > .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .terms-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.98rem;
        }

        .terms-row input[type="checkbox"] {
            accent-color: var(--spotify-green);
            width: 1.1em;
            height: 1.1em;
        }

        .btn-spotify {
            background-color: var(--spotify-green);
            color: var(--spotify-black);
            font-weight: bold;
            padding: 0.9rem;
            border-radius: 25px;
            width: 100%;
            border: none;
            font-size: 1.1rem;
            margin-top: 1.2rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-spotify:hover {
            background-color: #1ed760;
        }

        .divider {
            border-top: 1px solid #282828;
            margin: 1.5rem 0 1rem 0;
        }

        .center-align {
            text-align: center;
        }

        a {
            color: var(--spotify-green);
            text-decoration: none;
            transition: color 0.2s;
        }
        a:hover {
            color: #1ed760;
            text-decoration: underline;
        }

        @media (max-width: 600px) {
            .signup-container {
                padding: 1.3rem 0.6rem 1.2rem 0.6rem;
                max-width: 99vw;
            }
            .row-flex {
                flex-direction: column;
                gap: 0;
            }
        }
    </style>
</head>
<body>
    <div class="signup-container">
        <div class="logo">
            <i class="fab fa-spotify"></i>
        </div>
        <div class="signup-title">Sign up for free to start listening.</div>
        <form id="signupForm" method="POST" autocomplete="off" novalidate>
            {% csrf_token %}
            <!-- Username -->
            <div class="form-group">
                <label for="sign-up-username" class="form-label">
                    What's your name?
                    {% if not username %}
                      <span style="color:#f79862;">Username already exists</span>
                    {% endif %}
                </label>
                <div class="input-group">
                    <i class="fa fa-user"></i>
                    <input type="text" id="sign-up-username" class="form-control" name="username" pattern="[A-Za-z]+" placeholder="Enter your name" required>
                </div>
                <div class="error-message" id="usernameError"></div>
            </div>

            <!-- Email -->
            <div class="form-group">
                <label for="sign-up-email" class="form-label">
                    What's your email?
                    {% if not email %}
                      <span style="color:#f79862;">Email already exists</span>
                    {% endif %}
                </label>
                <div class="input-group">
                    <i class="fa fa-envelope"></i>
                    <input type="email" id="sign-up-email" class="form-control" name="email" placeholder="Enter your email" required>
                </div>
                <div class="error-message" id="emailError"></div>
            </div>

            <!-- Password -->
            <div class="form-group">
                <label for="pwd" class="form-label">Create a password</label>
                <div class="input-group">
                    <i class="fa fa-lock"></i>
                    <input type="password" id="pwd" class="form-control" name="password" placeholder="Create a password" required>
                    <i class="fa fa-eye toggle-password"></i>
                </div>
                <div class="error-message" id="passwordError"></div>
            </div>

            <!-- Confirm Password -->
            <div class="form-group">
                <label for="cpwd" class="form-label">Confirm your password</label>
                <div class="input-group">
                    <i class="fa fa-lock"></i>
                    <input type="password" id="cpwd" class="form-control" name="confirm-password" placeholder="Re-type your password" required>
                </div>
                <div class="error-message" id="confirmPasswordError"></div>
            </div>

            <!-- Row: DOB and Gender -->
            <div class="row-flex">
                <!-- Date of Birth -->
                <div class="form-group">
                    <label for="dob" class="form-label">Date of Birth</label>
                    <div class="input-group">
                        <i class="fa fa-calendar"></i>
                        <input type="date" id="dob" class="form-control" name="dob" required>
                    </div>
                    <div class="error-message" id="dobError"></div>
                </div>
                <!-- Gender -->
                <div class="form-group">
                    <label for="gender" class="form-label">Gender</label>
                    <div class="input-group">
                        <i class="fa fa-venus-mars"></i>
                        <select id="gender" class="form-select" name="gender" required>
                            <option value="" disabled selected>Select</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="error-message" id="genderError"></div>
                </div>
            </div>

            <!-- Terms -->
            <div class="form-group" style="margin-bottom: 0;">
                <div class="terms-row">
                    <input type="checkbox" id="terms" required>
                    <label for="terms" style="margin:0;">I agree to the <a href="#">Terms & Conditions</a></label>
                </div>
                <div class="error-message" id="termsError"></div>
            </div>

            <button class="btn-spotify" type="submit">Sign Up</button>
            <div class="divider"></div>
            <p class="center-align">Already have an account? <a href="/login">Log in</a>.</p>
        </form>
    </div>
    <script>
        // --- Form Elements ---
        const form = document.getElementById('signupForm');
        const username = document.getElementById('sign-up-username');
        const email = document.getElementById('sign-up-email');
        const pwd = document.getElementById('pwd');
        const cpwd = document.getElementById('cpwd');
        const dob = document.getElementById('dob');
        const gender = document.getElementById('gender');
        const terms = document.getElementById('terms');

        // --- Error Elements ---
        const usernameError = document.getElementById('usernameError');
        const emailError = document.getElementById('emailError');
        const passwordError = document.getElementById('passwordError');
        const confirmPasswordError = document.getElementById('confirmPasswordError');
        const dobError = document.getElementById('dobError');
        const genderError = document.getElementById('genderError');
        const termsError = document.getElementById('termsError');

        // --- Validation Functions ---
        function validateUsername() {
            if (!username.value.trim()) {
                usernameError.textContent = "Username is required";
                usernameError.style.display = "block";
                username.classList.add('is-invalid');
                return false;
            } else if (!/^[A-Za-z]+$/.test(username.value.trim())) {
                usernameError.textContent = "Only letters allowed";
                usernameError.style.display = "block";
                username.classList.add('is-invalid');
                return false;
            }
            usernameError.style.display = "none";
            username.classList.remove('is-invalid');
            return true;
        }

        function validateEmail() {
            const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!email.value.trim()) {
                emailError.textContent = "Email is required";
                emailError.style.display = "block";
                email.classList.add('is-invalid');
                return false;
            } else if (!regex.test(email.value.trim())) {
                emailError.textContent = "Enter a valid email address";
                emailError.style.display = "block";
                email.classList.add('is-invalid');
                return false;
            }
            emailError.style.display = "none";
            email.classList.remove('is-invalid');
            return true;
        }

        function validatePassword() {
            if (!pwd.value) {
                passwordError.textContent = "Password is required";
                passwordError.style.display = "block";
                pwd.classList.add('is-invalid');
                return false;
            } else if (pwd.value.length < 8) {
                passwordError.textContent = "Password must be at least 8 characters";
                passwordError.style.display = "block";
                pwd.classList.add('is-invalid');
                return false;
            }
            passwordError.style.display = "none";
            pwd.classList.remove('is-invalid');
            return true;
        }

        function validateConfirmPassword() {
            if (!cpwd.value) {
                confirmPasswordError.textContent = "Please confirm your password";
                confirmPasswordError.style.display = "block";
                cpwd.classList.add('is-invalid');
                return false;
            } else if (pwd.value !== cpwd.value) {
                confirmPasswordError.textContent = "Passwords do not match";
                confirmPasswordError.style.display = "block";
                cpwd.classList.add('is-invalid');
                return false;
            }
            confirmPasswordError.style.display = "none";
            cpwd.classList.remove('is-invalid');
            return true;
        }

        function validateDOB() {
            if (!dob.value) {
                dobError.textContent = "Date of birth is required";
                dobError.style.display = "block";
                dob.classList.add('is-invalid');
                return false;
            }
            const today = new Date();
            const birthDate = new Date(dob.value);
            const age = today.getFullYear() - birthDate.getFullYear();
            const m = today.getMonth() - birthDate.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            if (age < 13) {
                dobError.textContent = "You must be at least 13 years old";
                dobError.style.display = "block";
                dob.classList.add('is-invalid');
                return false;
            }
            dobError.style.display = "none";
            dob.classList.remove('is-invalid');
            return true;
        }

        function validateGender() {
            if (!gender.value) {
                genderError.textContent = "Please select your gender";
                genderError.style.display = "block";
                gender.classList.add('is-invalid');
                return false;
            }
            genderError.style.display = "none";
            gender.classList.remove('is-invalid');
            return true;
        }

        function validateTerms() {
            if (!terms.checked) {
                termsError.textContent = "You must agree to the terms";
                termsError.style.display = "block";
                return false;
            }
            termsError.style.display = "none";
            return true;
        }

        // --- Real-time Validation ---
        username.addEventListener('blur', validateUsername);
        email.addEventListener('blur', validateEmail);
        pwd.addEventListener('blur', validatePassword);
        cpwd.addEventListener('input', validateConfirmPassword);
        dob.addEventListener('change', validateDOB);
        gender.addEventListener('change', validateGender);
        terms.addEventListener('change', validateTerms);

        // --- Password Toggle ---
        document.querySelectorAll('.toggle-password').forEach(icon => {
            icon.addEventListener('click', function () {
                const input = this.previousElementSibling;
                const isPassword = input.type === 'password';
                input.type = isPassword ? 'text' : 'password';
                this.classList.toggle('fa-eye');
                this.classList.toggle('fa-eye-slash');
            });
        });

        // --- Form Submission ---
        form.addEventListener('submit', function(e) {
            let valid = true;
            if (!validateUsername()) valid = false;
            if (!validateEmail()) valid = false;
            if (!validatePassword()) valid = false;
            if (!validateConfirmPassword()) valid = false;
            if (!validateDOB()) valid = false;
            if (!validateGender()) valid = false;
            if (!validateTerms()) valid = false;

            if (!valid) {
                e.preventDefault();
            }
        });
    </script>
</body>
</html>
